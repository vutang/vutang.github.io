



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://www.vutang.github.io/projects/zedboard/zedboard/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Zedboard - Vu Tang's Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#zedboard" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.vutang.github.io/" title="Vu Tang's Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Vu Tang's Docs
              </span>
              <span class="md-header-nav__topic">
                Zedboard
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.vutang.github.io/" title="Vu Tang's Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Vu Tang's Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tech note
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tech note
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../technote/mkdocs/mkdocs-notes/" title="Mkdocs Tool" class="md-nav__link">
      Mkdocs Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../technote/markdown/markdown/" title="Markdown Language" class="md-nav__link">
      Markdown Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../technote/version_control/verctl/" title="Version Control" class="md-nav__link">
      Version Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../technote/makefile/makefile/" title="Makefile" class="md-nav__link">
      Makefile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Book & Materials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Book & Materials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../books/ldd3/" title="Linux Device Driver" class="md-nav__link">
      Linux Device Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../books/utlk/" title="Understanding Linux Kernel" class="md-nav__link">
      Understanding Linux Kernel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Projects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Zedboard
      </label>
    
    <a href="./" title="Zedboard" class="md-nav__link md-nav__link--active">
      Zedboard
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#boot-from-sd-card-with-ext4-filesystem" title="Boot from SD Card with ext4 filesystem" class="md-nav__link">
    Boot from SD Card with ext4 filesystem
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chuan-bi-sd-card" title="Chuẩn bị SD Card" class="md-nav__link">
    Chuẩn bị SD Card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at-boot-image-va-rootfs-len-sd-card" title="Cài đặt boot image và rootfs lên SD Card" class="md-nav__link">
    Cài đặt boot image và rootfs lên SD Card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phan-tich-va-ket-luan" title="Phân tích và kết luận" class="md-nav__link">
    Phân tích và kết luận
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpio" title="CPIO" class="md-nav__link">
    CPIO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-format-fat32-va-ext4" title="File system format: fat32 và ext4." class="md-nav__link">
    File system format: fat32 và ext4.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../zc706/" title="ZC706" class="md-nav__link">
      ZC706
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../whatnext/" title="What's next" class="md-nav__link">
      What's next
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about/about/" title="About me" class="md-nav__link">
      About me
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#boot-from-sd-card-with-ext4-filesystem" title="Boot from SD Card with ext4 filesystem" class="md-nav__link">
    Boot from SD Card with ext4 filesystem
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chuan-bi-sd-card" title="Chuẩn bị SD Card" class="md-nav__link">
    Chuẩn bị SD Card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at-boot-image-va-rootfs-len-sd-card" title="Cài đặt boot image và rootfs lên SD Card" class="md-nav__link">
    Cài đặt boot image và rootfs lên SD Card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phan-tich-va-ket-luan" title="Phân tích và kết luận" class="md-nav__link">
    Phân tích và kết luận
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpio" title="CPIO" class="md-nav__link">
    CPIO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-format-fat32-va-ext4" title="File system format: fat32 và ext4." class="md-nav__link">
    File system format: fat32 và ext4.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="zedboard">Zedboard</h1>
<h2 id="boot-from-sd-card-with-ext4-filesystem">Boot from SD Card with ext4 filesystem</h2>
<p><a href="https://1drv.ms/w/s!Ai73O1i3QXDegSRrRM90Eg6kw66H">Origin Note</a></p>
<p><strong>Chuẩn bị images</strong></p>
<p>Trong tài liệu <a href="https://www.xilinx.com/support/documentation/sw_manuals/petalinux2015_4/ug1144-petalinux-tools-reference-guide.pdf">UG1144</a> có hướng dẫn quá trình cấu hình để có thể khởi động Zynq7000 từ SD Card. Trong hướng dẫn này cần lưu ý đến 2 điểm sau:</p>
<ul>
<li>
<p>Thiết lập petalinux project để các image được package dưới dạng có
thể boot được từ SD Card.</p>
<p><code>petalinux-config</code></p>
</li>
<li>
<p>Tạo file rootfs.cpio bằng mã lệnh sau</p>
<p><code>petalinux-package \--image -c rootfs \--format initramfs</code></p>
</li>
</ul>
<p>Nếu sử dụng lệnh package để tạo rootfs.cpio xuất hiện lỗi sau:</p>
<blockquote>
<p>[INFO ] package rootfs.cpio to /tmp/petalinux/images/linux\
 ERROR: Linux kernel gen_init_cpio /tmp/petalinux/build/linux/kernel/usr/gen_init_cpio doesn\'t exits! Please build Linux kernel first!\</p>
<p>make[1]: *** [package-rootfs-cpio] Fehler 255\</p>
<p>make: *** [package-rootfs-initramfs] Fehler 2\
 ERROR: Failed to package component linux/rootfs</p>
</blockquote>
<p>Trong diễn đàn của Xilinx (<a href="https://forums.xilinx.com/t5/Embedded-Linux/Error-when-rootfs-is-placed-on-SD-card/td-p/684101">link</a>) có thảo luận về phương pháp để khắc phục được lỗi trên. Bao gồm các bước xử lý như sau:</p>
<ul>
<li>Tắt chế độ automatic kernel configuration</li>
</ul>
<blockquote>
<p>petalinux-config\
  Image Packaging Configuration ---> Root filesystem type = SD card\
  Auto Config Settings ---> [ ] kernel autoconfig</p>
</blockquote>
<ul>
<li>Bật chế độ hỗ trọ INITRAMFS trong cấu hình của kernel</li>
</ul>
<blockquote>
<p>$ petalinux-config -c kernel                                         </p>
<p>General setup -&gt;                                                 </p>
<p>[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support </p>
<p>() Initramfs source file(s)                                           </p>
</blockquote>
<h3 id="chuan-bi-sd-card">Chuẩn bị SD Card</h3>
<p>Cần chuẩn bị SD Card với 02 phân vùng:</p>
<ul>
<li>
<p>BOOT: được format ở định dạng FAT32 chứa BOOT.BIN (bao gồm FBSL, PL
Bitstream, U-boot) và image.ub (Linux kernel và Device Tree).</p>
</li>
<li>
<p>rootfs: được format ở định dạng ext4 chứa root filesystem.</p>
</li>
</ul>
<p>Quá trình chuẩn bị phân vùng trên SD Card này sẽ được tiến hành đơn giản
bằng các GUI Tool như <a href="https://gparted.org/">GParted</a>.</p>
<p>Ngoài ra có thể sử dụng tổ hợp CLI tool: fdisk &amp; mkfs.vfat &amp; mkfs.ext4.
Phương pháp sử dụng bộ công cụ này được mô tả chi tiết trong <a href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842385/How+to+format+SD+card+for+SD+boot">Wikipedia</a>
của Xilinx.</p>
<p>Kết quả của quá trình phân vùng và format này như sau:</p>
<p><img alt="sdpartition" src="../img/sd-card-partition.png" /></p>
<p><em>Figure. SD Card Partitions</em></p>
<h3 id="cai-at-boot-image-va-rootfs-len-sd-card">Cài đặt boot image và rootfs lên SD Card</h3>
<p>Kết quả sau khi thực hiện xong các bước chuẩn bị liên quan đến images và
SD Card:</p>
<ul>
<li>
<p>Các file images: BOOT.BIN, image.ub và rootfs.cpio</p>
</li>
<li>
<p>SD Card với hai phân vùng: BOOT và rootfs.</p>
</li>
</ul>
<p>Các images và filesystem phải được cài đặt lên SD Card trước khi board
có thể khởi động được từ SD Card.</p>
<p>Quá trình cài đặt bootloader và Linux kernel là quá trình copy BOOT.BIN
và image.ub lên phân vùng BOOT của sdcard. BootROM của zynq đủ mạnh để
có thể tìm kiếm được zynq_fsbl.elf trên phân vùng định dạng FAT32 để
khởi động.</p>
<p>Riêng rootfs đang được đóng gói ở file rootfs.cpio. Sử dụng ứng dụng pax
để tháo dỡ filesystem đang được đóng gói ở định dạng cpio.</p>
<p><code>cp images/linux/rootfs.cpio /media/rootfs/</code></p>
<p><code>cd /media/rootfs</code></p>
<p><code>sudo pax -rvf rootfs.cpio</code></p>
<h3 id="phan-tich-va-ket-luan">Phân tích và kết luận</h3>
<p>Trong quá trình chuẩn bị SD Card xuất hiện các thuật ngữ. Trong mục này
sẽ đi phân tích và giải thích các thuật ngữ đó.</p>
<h4 id="cpio">CPIO</h4>
<p>Trong hệ điều hành Linux xuất hiện khái niệm archive file, là kết quả
của quá trình đóng gói nhiều file dữ liệu thành một file thống nhất
(không có quá trình nén dữ liệu). Mục đích của quá trình đóng gói này là
dễ dàng cho quá trình lưu trữ cũng như trao đổi dữ liệu. Archive file
cũng được sử dụng làm đầu vào cho các trình nén dữ liệu.</p>
<p>Archive file được đóng gói bằng các file archiver. Trong Unix-like
system, các file archiver phổ biến như: tar, ar, cpio.</p>
<p>Rootfs kết quả của bước 1 đang được đóng gói dưới dạng archive file -
cpio. Quá trình cài đặt rootfs lên phân vùng rootfs trên SD Card bản
chất là quá trình tháo dỡ các archive file trở về các file phân biệt ban
đầu.</p>
<p>Quá trình extract này có thể được thực hiện bởi các Linux tool như: cpio
hoặc pax. Trong hướng dẫn của Xilinx sử dụng pax để tháo dỡ rootfs.</p>
<h4 id="file-system-format-fat32-va-ext4">File system format: fat32 và ext4.</h4>
<p>File system là cách mà một hệ thống file được tổ chức trên các bộ nhớ
lưu trữ. Các bộ nhớ lưu trữ có thể là: disk file system hoặc flash file
system.</p>
<p>Fat32 và ext4 là tên của các dạng file system được tổ chức phổ biến trên
các dòng disk file system như SD Card trong bài viết này là một ví dụ.
Ngoài ra trong quá trình làm việc với Rootfs của zynq có thể sử dụng đến
JFFS2 format là một định dạng file system sử dụng cho các bộ nhớ flash.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../books/utlk/" title="Understanding Linux Kernel" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Understanding Linux Kernel
              </span>
            </div>
          </a>
        
        
          <a href="../../zc706/" title="ZC706" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                ZC706
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Vu Tang.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>