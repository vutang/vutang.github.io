



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://www.vutang.github.io/lnx_ldd/overview/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Overview - Vu Tang's Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#overview-about-linux-device-driver" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.vutang.github.io/" title="Vu Tang's Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Vu Tang's Docs
              </span>
              <span class="md-header-nav__topic">
                Overview
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.vutang.github.io/" title="Vu Tang's Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Vu Tang's Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      General Technote
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        General Technote
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/mkdocs/mkdocs-notes/" title="Mkdocs Tool" class="md-nav__link">
      Mkdocs Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/markdown/markdown/" title="Markdown Language" class="md-nav__link">
      Markdown Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/shellscript/shellscript/" title="Shell Script" class="md-nav__link">
      Shell Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/python/python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Book & Materials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Book & Materials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/c_books/" title="C Programing" class="md-nav__link">
      C Programing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/linux/" title="Linux Programing" class="md-nav__link">
      Linux Programing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/device_driver/" title="Linux Device Driver" class="md-nav__link">
      Linux Device Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/linux_kernel/" title="Linux Kernel" class="md-nav__link">
      Linux Kernel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/es_linux/" title="Linux Embedded" class="md-nav__link">
      Linux Embedded
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/dsa/dsa_toc/" title="Data Structure & Algorithms" class="md-nav__link">
      Data Structure & Algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/others/" title="Others" class="md-nav__link">
      Others
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Programming
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Programming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/C/cprogramming/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/dsa/dsa/" title="DSA" class="md-nav__link">
      DSA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/sql/mysql/" title="SQL" class="md-nav__link">
      SQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/lnx/lpi/" title="Linux Programming Interfaces" class="md-nav__link">
      Linux Programming Interfaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/dsg_patterns/" title="Design Patterns" class="md-nav__link">
      Design Patterns
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../programming/multi-threaded-programming/" title="Multi-threads" class="md-nav__link">
      Multi-threads
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Linux General
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Linux General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx/linux/" title="Unsorted" class="md-nav__link">
      Unsorted
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Linux ES Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Linux ES Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_es/es/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_es/hw_platform/" title="HW Platforms" class="md-nav__link">
      HW Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_es/cmn_tool/" title="Common Tools" class="md-nav__link">
      Common Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_es/ptlnx/" title="Xilinx Petalinux" class="md-nav__link">
      Xilinx Petalinux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_es/yocto/" title="Yocto" class="md-nav__link">
      Yocto
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_es/tips/tips/" title="Tips" class="md-nav__link">
      Tips
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Linux Device Driver
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Linux Device Driver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Overview
      </label>
    
    <a href="./" title="Overview" class="md-nav__link md-nav__link--active">
      Overview
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux-system-overview" title="Linux System Overview" class="md-nav__link">
    Linux System Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-device-model" title="Linux Device Model" class="md-nav__link">
    Linux Device Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-module" title="Kernel Module" class="md-nav__link">
    Kernel Module
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inh-nghia" title="Định nghĩa" class="md-nav__link">
    Định nghĩa
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module_init-module_exit" title="module_init &amp; module_exit" class="md-nav__link">
    module_init &amp; module_exit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-log-trong-kernel" title="In log trong kernel" class="md-nav__link">
    In log trong kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at-lkm-module-vao-he-thong" title="Cài đặt LKM module vào hệ thống" class="md-nav__link">
    Cài đặt LKM module vào hệ thống
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compile-a-kernel-module" title="Compile a kernel module" class="md-nav__link">
    Compile a kernel module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#character-device-driver" title="Character Device Driver" class="md-nav__link">
    Character Device Driver
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-file" title="Device File" class="md-nav__link">
    Device File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#major-minor" title="Major &amp; Minor" class="md-nav__link">
    Major &amp; Minor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#khai-bao-mot-character-device-file" title="Khai báo một Character Device File" class="md-nav__link">
    Khai báo một Character Device File
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cap-phat-device-number" title="Cấp phát Device Number" class="md-nav__link">
    Cấp phát Device Number
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ang-ky-character-device-file" title="Đăng ký Character Device File" class="md-nav__link">
    Đăng ký Character Device File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cdev_init-cdev_add" title="cdev_init &amp; cdev_add" class="md-nav__link">
    cdev_init &amp; cdev_add
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutex" title="Mutex" class="md-nav__link">
    Mutex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mmap" title="MMAP" class="md-nav__link">
    MMAP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ioctl" title="IOCTL" class="md-nav__link">
    IOCTL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giao-tiep-voi-phan-cung" title="Giao tiếp với phần cứng" class="md-nav__link">
    Giao tiếp với phần cứng
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#platform-device" title="Platform Device" class="md-nav__link">
    Platform Device
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct-resource" title="struct resource" class="md-nav__link">
    struct resource
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kernel_module/" title="Kernel Module" class="md-nav__link">
      Kernel Module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../platform_dev/platform_device/" title="Platform Device" class="md-nav__link">
      Platform Device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spi_dev/spi_dev/" title="SPI Device" class="md-nav__link">
      SPI Device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spi_dev/spi_advance/" title="SPI Device Advance" class="md-nav__link">
      SPI Device Advance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gpio/gpio/" title="GPIO" class="md-nav__link">
      GPIO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../uart/uart/" title="UART" class="md-nav__link">
      UART
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jesd/jesd/" title="JESD" class="md-nav__link">
      JESD
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Linux Kernel Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Linux Kernel Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_kernel/kernel_data_structure/" title="Kernel Data Structure" class="md-nav__link">
      Kernel Data Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lnx_kernel/kernel_user_space/" title="Kernel Space, User Space Interfaces" class="md-nav__link">
      Kernel Space, User Space Interfaces
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      FPGA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        FPGA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/timing_analysis/timing_analysis/" title="Static Timing Analysis" class="md-nav__link">
      Static Timing Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/x_ipcore/xipcore/" title="Xilinx IPCore" class="md-nav__link">
      Xilinx IPCore
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Projects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/pcie/pcie/" title="PCIe" class="md-nav__link">
      PCIe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/zynq/zynq/" title="Zynq" class="md-nav__link">
      Zynq
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/imx8/imx8/" title="IMX8" class="md-nav__link">
      IMX8
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/pi3b/" title="Raspberrypi 3B" class="md-nav__link">
      Raspberrypi 3B
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../bookmarks/bookmarks/" title="Bookmarks" class="md-nav__link">
      Bookmarks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../whatnext/" title="What's next" class="md-nav__link">
      What's next
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/about/" title="About me" class="md-nav__link">
      About me
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux-system-overview" title="Linux System Overview" class="md-nav__link">
    Linux System Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-device-model" title="Linux Device Model" class="md-nav__link">
    Linux Device Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-module" title="Kernel Module" class="md-nav__link">
    Kernel Module
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inh-nghia" title="Định nghĩa" class="md-nav__link">
    Định nghĩa
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module_init-module_exit" title="module_init &amp; module_exit" class="md-nav__link">
    module_init &amp; module_exit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-log-trong-kernel" title="In log trong kernel" class="md-nav__link">
    In log trong kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai-at-lkm-module-vao-he-thong" title="Cài đặt LKM module vào hệ thống" class="md-nav__link">
    Cài đặt LKM module vào hệ thống
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compile-a-kernel-module" title="Compile a kernel module" class="md-nav__link">
    Compile a kernel module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#character-device-driver" title="Character Device Driver" class="md-nav__link">
    Character Device Driver
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-file" title="Device File" class="md-nav__link">
    Device File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#major-minor" title="Major &amp; Minor" class="md-nav__link">
    Major &amp; Minor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#khai-bao-mot-character-device-file" title="Khai báo một Character Device File" class="md-nav__link">
    Khai báo một Character Device File
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cap-phat-device-number" title="Cấp phát Device Number" class="md-nav__link">
    Cấp phát Device Number
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ang-ky-character-device-file" title="Đăng ký Character Device File" class="md-nav__link">
    Đăng ký Character Device File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cdev_init-cdev_add" title="cdev_init &amp; cdev_add" class="md-nav__link">
    cdev_init &amp; cdev_add
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutex" title="Mutex" class="md-nav__link">
    Mutex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mmap" title="MMAP" class="md-nav__link">
    MMAP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ioctl" title="IOCTL" class="md-nav__link">
    IOCTL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#giao-tiep-voi-phan-cung" title="Giao tiếp với phần cứng" class="md-nav__link">
    Giao tiếp với phần cứng
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#platform-device" title="Platform Device" class="md-nav__link">
    Platform Device
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct-resource" title="struct resource" class="md-nav__link">
    struct resource
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="overview-about-linux-device-driver">Overview about Linux Device Driver</h1>
<p>Tài liệu này mô tả các khái niệm chung về Linux Device Driver. Cần có các bài tìm hiểu chuyên sâu về các mục trong phần này.</p>
<p><a href="https://1drv.ms/w/s!Ai73O1i3QXDegSVgUBDGS7VCCCeH">Original note</a></p>
<h2 id="linux-system-overview">Linux System Overview</h2>
<p><img alt="userspace-kernelspace" src="../img/ldd1.png" /></p>
<h2 id="linux-device-model">Linux Device Model</h2>
<p>Các thiết bị kết nối đến CPU được gọi là <strong>Device</strong>. Mỗi device này cung cấp
các tài nguyên khác nhau đến người dùng, <strong>Linux kernel</strong> thông qua <strong>device
driver</strong> để giao tiếp đến device và sử dụng các tài nguyên của device đó.</p>
<p>Các device kết nối đến CPU bằng một bus. Nó có thể là các bus giao tiếp
với thiết bị ngoại vi như SPI, I2C, hoặc cũng có thể là system bus của
hệ thống. Lưu ý rằng Linux Kernel cũng nhìn bus giống như một device và
tất nhiên device thì cần phải được khai báo. Do đó Linux Kernel cũng
cung cấp các quy trình để đăng ký một bus với hệ thống.</p>
<p>Trong quá trình khởi động, dựa vào thông tin mà device-tree cung cấp về
các device trong hệ thống, Linux Kernel gọi đến các device driver tương
ứng để dò tìm và thêm thiết bị vào hệ thống.</p>
<p>Platform device là các device đầu tiên được dò tìm và thêm vào hệ thống.
Đơn giản có thể hiểu các platform device là các thiết bị được quản lý
trực tiếp trong vùng nhớ của CPU, là các thực thể được nối với system
bus của CPU. System bus này được gọi là platform bus.</p>
<p><img alt="linux device model" src="../img/ldd2.png" />
<em>Figure. An example about device model</em></p>
<h2 id="kernel-module">Kernel Module</h2>
<h3 id="inh-nghia">Định nghĩa</h3>
<p>Kernel Module là một đoạn mã có thể được cài đặt hoặc gỡ cài đặt khỏi
Kernel theo yêu cầu. Kernel module giúp mở rộng chức năng cho kernel mà
không cần phải khởi động lại hệ thống. Device Driver là một loại kernel
module. Trong trường hợp cần thêm một chức năng vào kernel trong khi
không có kernel module, người phát triển sẽ cần phải build lại cả hệ
thống.</p>
<p>Một blog viết về Kernel Module tương đối hay và chi tiết có thể xem thêm
<a href="http://derekmolloy.ie/writing-a-linux-kernel-module-part-1-introduction/">tại đây</a>. Blog được viết bởi Derek Molloy.</p>
<p>Kernel Module cũng được định nghĩa tại một bài viết của ArchLinux (một
Linux Distro) <a href="https://wiki.archlinux.org/index.php/Kernel_module">tại đây</a>. Ngoài ra, tai trang web tldp.org có
một chuỗi các bài viết liên quan đến phát triển Kernel module (<a href="http://tldp.org/LDP/lkmpg/2.6/html/index.html">The
Linux Kernel Module Programming Guide</a>).</p>
<p>Có hai dạng Kernel module: build-in và loadable file. Trong đó built-in
module được tích hợp vào Kernel Image và được cài đặt vào hệ thống trong
quá trình khởi động kernel. Người lại, loadable module có thể được người
dùng cài đặt vào hệ thống sau khi kernel đã khởi động thành công.</p>
<p><strong>Loadable Kernel Module (LKM)</strong> được cài đặt vào hệ thống bằng các câu lệnh
như modprobe hoặc insmod.</p>
<h3 id="module_init-module_exit">module_init &amp; module_exit</h3>
<p>Kernel module có thể được hiểu là một chương trình chạy trong Kernel
Space, nhưng không giống như chương trình bình thường, kernel module
không bắt đầu bằng hàm "main".</p>
<p>Macro <code>module_init()</code> và <code>module_exit()</code> được sử dụng để đăng ký các hàm
khởi tạo và hàm hủy cho kernel module. Tùy thuộc vào kernel module là
built-in hay LKM mà nội dụng của module_init/exit sẽ khác nhau.</p>
<p>Trong trường hợp là built-in module, module_init sẽ gọi đến macro
<code>_init_call</code> dùng để đăng ký với hệ thống là module sẽ được khởi tạo
trọng quá trình init. Hai macro được định nghĩa trong linux/init.h.</p>
<h3 id="in-log-trong-kernel">In log trong kernel</h3>
<p>Phương pháp debug cơ bản và phổ biến nhất khi đi phát triển một chương
trình là in log chạy của chương trình đó ra màn hình hoặc file. Kernel
module sử dụng lệnh prink thay vì printf như phát triển ứng dụng User
space.</p>
<p>Ngoài ra có thể sử dụng thêm các họ hàm dev_<em> và pr_</em> để in thêm
thông tin trong kernel module.</p>
<h3 id="cai-at-lkm-module-vao-he-thong">Cài đặt LKM module vào hệ thống</h3>
<p>Để cài đặt LKM vào hệ thống có thể sử dụng lệnh <code>insmod/rmmod/lsmod</code>. Ngoài ra có thể dùng thêm modprobe. Quá trình sử dụng modprobe phức tạp hơn insmod, có thể đọc thêm <a href="https://www.computerhope.com/unix/modprobe.htm">[tại đây]</a>. Trong quá trình cài đặt module vào hệ thống có thể thêm các paramtters cho module.</p>
<p>Để liệt kê toàn bộ thông tin của các module đang được cài đặt trong hệ
thống có thể sử dụng lsmod. Lsmod đọc thông tin từ /proc/modules, người
dùng có thể đọc trực tiếp từ text file /proc/modules để biết thêm được
thông tin của các module đang chạy trong hệ thống.</p>
<p>Khi một module được cài đặt vào hệ thống, thông tin về module này có thể
được tìm thấy trong sysfs virtual file system <code>/sys/module</code></p>
<h3 id="compile-a-kernel-module">Compile a kernel module</h3>
<p>Để build một kernel module, Linux Kernel sử dụng một hệ thống gọi là
kbuild. Có thể đọc thêm thông tin về hệ thống kbuild này trong Kernel
Documentation (<code>kbuild/modules.txt</code>). Trong mục 2.2 của [1] có giới
thiệu về build kernel module.</p>
<h2 id="character-device-driver">Character Device Driver</h2>
<p>Device Driver là một kernel module, có chức năng giao tiếp trực tiếp với
phần cứng và cung cấp các giao diện để các module khác của kernel cũng
như user có thể truy cập và sử dụng các tài nguyên liên quan đến các
phần cứng tương ứng.</p>
<p>Tùy thuộc vào loại phần cứng tương ứng mà device driver được chia ra làm
các loại khác nhau. Trong tài liệu LDD3, device driver được chia ra làm
3 loại chính: char module, block module và network module.</p>
<p>Trong đó character device sẽ được tập trung nghiên cứu trong tài liệu
này.</p>
<p><img alt="call_path" src="../img/ldd3.png" /></p>
<p>Như vậy, một device driver nói chung cần thực hiện hai nhiệm vụ chính:</p>
<ul>
<li>
<p>Cung cấp các giao diện để có thể giao tiếp được với User Space, qua
đó các ứng dụng của người dùng có thể giao tiếp được với phần cứng thông
qua các giao diện này.</p>
</li>
<li>
<p>Truy cập đến phần cứng. Device driver được sinh ra là để giao tiếp
trực tiếp với phần cứng.</p>
</li>
</ul>
<p>Trong tài liệu này sẽ tìm hiểu từng nhiệm vụ trên của Device Driver.</p>
<h3 id="device-file">Device File</h3>
<p>Device file hay special file là một giao diện để người dùng có thể giao
tiếp được với device driver. Thông thường các device file xuất hiện
trong /dev/ và được quản lý bởi virtual file system.</p>
<p>Người dùng thông qua các <strong>System Call</strong> để tương tác với device driver
thông qua device file. Các System Call liên quan đến tương tác file được
xử lý bởi hệ thống VFS (Virtual File System) như: open(), close(),
read(), write(), mmpa()... Quá trình hoạt động của các system call này
được mô tả rõ trong Chapter 12: The Virtual File System của sách
Understanding Linux Kernel.</p>
<p><img alt="devDir" src="../img/ldd4.png" /></p>
<p>Vậy với một normal file, các người dùng có thể tác động gì được? Thông
tin này có thể tìm hiểu qua từ khóa "Working with file in C".</p>
<h3 id="major-minor">Major &amp; Minor</h3>
<p>Mỗi Device File trong /dev/ được đặc trưng bởi hai tham số: <code>&lt;Major, Minor&gt;</code>. </p>
<ul>
<li>Major được sử dụng để xác định xem device đó tương ứng với
driver nào. </li>
<li>Minor mang thông tin của từng thiết bị, về cơ bản nhiều
thiết bị có thể điều khiển bằng một driver, do đó trong một số hệ thống,
driver sử dụng Minor để phân biệt giữa các thiết bị với nhau.</li>
</ul>
<p>Major và Minor tạo thành một cặp số unsigned để đặc trưng cho một
device, gọi là Device Number. Kernel sử dụng kiểu dữ liệu <code>dev_t</code> để mô tả
hai tham số này.</p>
<p>Dev_t được định nghĩa trong header linux/types dưới dạng một số 32 bit.</p>
<pre><code class="c++"> typedef __u32 __kernel_dev_t; 
 typedef __kernel_dev_t dev_t;  
</code></pre>

<p>Trong đó, 20 bit thấp được sử dụng cho Minor và các bit cao còn lại được
sử dụng cho Major. Các macro sử dụng cho dev_t như <code>MKDEV, MAJOR, MINOR</code>
được khai báo trong <code>linux/k_dev_t.h</code>.</p>
<p>Có thể tạo một Device File đơn giản bằng Command: </p>
<p><code>mknod /dev/coffee c 12 2</code>.</p>
<h3 id="khai-bao-mot-character-device-file">Khai báo một Character Device File</h3>
<h4 id="cap-phat-device-number">Cấp phát Device Number</h4>
<p>Hàm <code>register_chrdev_region()</code> được sử dụng để đăng ký device number.</p>
<p><code>int register_chrdev_region(dev_t from, unsigned count, const char
*name);</code></p>
<p>Quá trình này là cấp phát tĩnh dev_t, trong một số trường hợp yêu cầu
cấp phát này không thành công do yêu cầu của driver không phù hợp với
yêu cầu hiện tại của hệ thống. Trong trường hợp đó có thể sử dụng hàm
<code>alloc_chrdev_region()</code>. Nguyên mẫu của hàm đó như sau:</p>
<p><code>int alloc_chrdev_region(dev_t *dev, unsigned baseminor, unsigned
count,*const char *name);</code></p>
<p>Kết quả của quá trình cấp phát device number là Major và một dải Minor
mà driver có thể sử dụng.</p>
<h4 id="ang-ky-character-device-file">Đăng ký Character Device File</h4>
<p>Kernel sử dụng một cấu trúc dữ liệu để lưu giữ thông tin của một
character device: struct cdev. Struct cdev được định nghĩa trong
<code>linux/cdev.h</code> bao gồm các trường thông tin ở bảng sau.</p>
<pre><code>structcdev{
    struct kobject kobj;
    struct module *owner;
    const struct file_operations *ops;
    struct list_head list;
    dev_t dev;
    unsigned int count;
} __randomize_layout;
</code></pre>

<p>Mỗi char device tương ứng với một device number dev_t và có các
file_operations tướng ứng. Các file_operations (định nghĩa trong
<code>linux/fs.h</code>) được mô tả trong bảng sau.</p>
<pre><code>struct file_operations {
    ssize_t (*read) (struct file *, char __user *, size_t, loff_t *);
    ssize_t (*write) (struct file *, const char __user *, size_t, loff_t *);
    int (*mmap) (struct file *, struct vm_area_struct *);
    long (*unlocked_ioctl) (struct file *, unsigned int, unsigned long);
    [some feilds obmitted]
} __randomize_layout;   
</code></pre>

<h4 id="cdev_init-cdev_add">cdev_init &amp; cdev_add</h4>
<p>Trước khi khởi tạo và đăng ký một cdev với kernel, một vùng nhớ sử dụng
cho biến cdev này phải được khởi tạo. Phương pháp đơn giản nhất là khai
báo một biến toàn cục trong driver.</p>
<p>Quá trình <code>cdev_init</code> bản chất là trang bị file_openratons cho cdev và
thêm nó vào danh sách các thiết bị đã được khai báo trong hệ thống. Hàm
<code>cdev_add</code> tiến hành thêm cdev vào hệ thống.</p>
<p>Lưu ý nguyên mẫu hàm cdev_add như sau:</p>
<p><code>int cdev_add(struct cdev *p, dev_t dev, unsigned count);</code></p>
<p>Trong đó con trỏ p được trỏ đến biến cdev đã được khai báo, và <code>dev_t
dev</code> là device number đầu tiên trong dãy các device number liên quan đến
cdev này, count là số lượng các minor number liên tiếp sau <code>MINOR(dev_t
dev)</code> liên quan đến device này.</p>
<p>Giả sử ta tiến hành thêm một cdev như sau:</p>
<pre><code>struct cdev mycdev;
dev_t mydevno = MKDEV(246, 0);
cdev_add(mycdev, mydevno, 4);
</code></pre>

<p>Và sau đó khởi tạo thêm 4 files.</p>
<pre><code>mknod /dev/scull0 c 246 0
mknod /dev/scull1 c 246 1 
mknod /dev/scull2 c 246 2 
mknod /dev/scull3 c 246 3 
</code></pre>

<p>Khi tiến hành đọc ghi các <code>/dev/file</code> này đểu trả về một <code>dev_t</code> duy nhất
&lt;246, 0&gt;.</p>
<h2 id="mutex">Mutex</h2>
<p><a href="http://derekmolloy.ie/writing-a-linux-kernel-module-part-2-a-character-device/">http://derekmolloy.ie/writing-a-linux-kernel-module-part-2-a-character-device/</a></p>
<h2 id="mmap">MMAP</h2>
<p><a href="https://nhauyeneducation.blogspot.com/2018/11/hieu-ve-to-chuc-bo-nho-linux-thong-qua.html?fbclid=IwAR2w4W3yttmtqbZYqcwzTQ95Qvs92ZXDdBXns9kgO7IeokpVvoc8OY3IVLo">https://nhauyeneducation.blogspot.com/2018/11/hieu-ve-to-chuc-bo-nho-linux-thong-qua.html?fbclid=IwAR2w4W3yttmtqbZYqcwzTQ95Qvs92ZXDdBXns9kgO7IeokpVvoc8OY3IVLo</a></p>
<p><a href="https://linux-kernel-labs.github.io/master/labs/memory_mapping.html">https://linux-kernel-labs.github.io/master/labs/memory_mapping.html</a></p>
<h2 id="ioctl">IOCTL</h2>
<p><a href="https://ufal.mff.cuni.cz/~jernej/2018/docs/predavanja06.pdf">https://ufal.mff.cuni.cz/~jernej/2018/docs/predavanja06.pdf</a></p>
<p>Ioctl - Input Output Control được sinh ra để hỗ trợ người dùng khai báo
thêm các câu lệnh mới phù hợp với từng dòng thiết bị.</p>
<p>Trong ví dụ liên quan đến bài đào tạo, led_controller_core có hai tham
số có thể cấu hình được trong quá trình chạy:</p>
<ul>
<li>
<p>SPEED: Tốc độ LED.</p>
</li>
<li>
<p>POSITION: Vị trí LED nháy.</p>
</li>
</ul>
<p>-&gt; Mục tiêu cần phải định nghĩa được một số câu lệnh để làm ví dụ trong
quá trình phát triển.</p>
<h2 id="giao-tiep-voi-phan-cung">Giao tiếp với phần cứng</h2>
<h2 id="platform-device">Platform Device</h2>
<p>Giao tiếp với phần cứng trong một hệ nhúng rất đa dạng. Phương pháp giao
tiếp với phần tử trong hệ nhúng phụ thuộc vào loại thiết bị của phần tử
đó. Trong phạm vi bài viết này sẽ tương tác với một loại thiết bị:
platform_device.</p>
<h3 id="struct-resource">struct resource</h3>
<p>platform_get_resource thực hiện tìm kiếm tất cả các resource hiện tại
có trong platform_device. Quá trình tìm kiếm dựa vào loại resource được
định nghĩa trong linux/ioport.h. Các loại resource cơ bản như:</p>
<ul>
<li>IORESOURCE_MEM (memory) </li>
<li>IORESOURCE_IRQ (interupt)</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../lnx_es/tips/tips/" title="Tips" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tips
              </span>
            </div>
          </a>
        
        
          <a href="../kernel_module/" title="Kernel Module" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Kernel Module
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Vu Tang.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>