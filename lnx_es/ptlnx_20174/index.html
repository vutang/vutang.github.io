



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://www.vutang.github.io/lnx_es/ptlnx_20174/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Petalinux 2017.4 technical note - Vu Tang's Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#petalinux-20174-technical-note" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.vutang.github.io/" title="Vu Tang's Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Vu Tang's Docs
              </span>
              <span class="md-header-nav__topic">
                Petalinux 2017.4 technical note
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.vutang.github.io/" title="Vu Tang's Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Vu Tang's Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      General Technote
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        General Technote
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/mkdocs/mkdocs-notes/" title="Mkdocs Tool" class="md-nav__link">
      Mkdocs Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/markdown/markdown/" title="Markdown Language" class="md-nav__link">
      Markdown Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/shellscript/shellscript/" title="Shell Script" class="md-nav__link">
      Shell Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/python/python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Book & Materials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Book & Materials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/c_books/" title="C Programing" class="md-nav__link">
      C Programing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/ldd3/" title="Linux Device Driver" class="md-nav__link">
      Linux Device Driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../books/utlk/" title="Understanding Linux Kernel" class="md-nav__link">
      Understanding Linux Kernel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Linux ES Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Linux ES Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../es/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hw_platform/" title="HW Platforms" class="md-nav__link">
      HW Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmn_tool/" title="Common Tools" class="md-nav__link">
      Common Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ptlnx/" title="Xilinx Petalinux" class="md-nav__link">
      Xilinx Petalinux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../yocto/" title="Yocto" class="md-nav__link">
      Yocto
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technote/tips/tips/" title="Tips" class="md-nav__link">
      Tips
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Linux Device Driver
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Linux Device Driver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/kernel_module/" title="Kernel Module" class="md-nav__link">
      Kernel Module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/platform_dev/platform_device/" title="Platform Device" class="md-nav__link">
      Platform Device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/spi_dev/spi_dev/" title="SPI Device" class="md-nav__link">
      SPI Device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/spi_dev/spi_advance/" title="SPI Device Advance" class="md-nav__link">
      SPI Device Advance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/gpio/gpio/" title="GPIO" class="md-nav__link">
      GPIO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ldd/uart/uart/" title="UART" class="md-nav__link">
      UART
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Linux Kernel Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Linux Kernel Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux_kernel_dev/kernel_data_structure/" title="Kernel Data Structure" class="md-nav__link">
      Kernel Data Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux_kernel_dev/kernel_user_space/" title="Kernel Space, User Space Interfaces" class="md-nav__link">
      Kernel Space, User Space Interfaces
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      FPGA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        FPGA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/timing_analysis/timing_analysis/" title="Static Timing Analysis" class="md-nav__link">
      Static Timing Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/x_ipcore/xipcore/" title="Xilinx IPCore" class="md-nav__link">
      Xilinx IPCore
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Projects
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/zedboard/zedboard/" title="Zedboard" class="md-nav__link">
      Zedboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/zc706/" title="ZC706" class="md-nav__link">
      ZC706
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/pi3b/" title="Raspberrypi 3B" class="md-nav__link">
      Raspberrypi 3B
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../u-boot/" title="Zynq from scratch" class="md-nav__link">
      Zynq from scratch
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../bookmarks/bookmarks/" title="Bookmarks" class="md-nav__link">
      Bookmarks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../whatnext/" title="What's next" class="md-nav__link">
      What's next
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/about/" title="About me" class="md-nav__link">
      About me
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introdutions" title="Introdutions" class="md-nav__link">
    Introdutions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips" title="Tips" class="md-nav__link">
    Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worknote" title="Worknote" class="md-nav__link">
    Worknote
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiences" title="Experiences" class="md-nav__link">
    Experiences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-and-initialize-a-project" title="Create and initialize a project" class="md-nav__link">
    Create and initialize a project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-a-new-project-without-internet" title="Build a new project without Internet" class="md-nav__link">
    Build a new project without Internet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boot-from-sd-card" title="Boot from SD card" class="md-nav__link">
    Boot from SD card
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-sd-card-in-booting-time" title="Mounting SD card in booting-time" class="md-nav__link">
    Mounting SD card in booting-time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-user-custom-package" title="Add user custom package" class="md-nav__link">
    Add user custom package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#petalinux-imagebbappend" title="petalinux-image.bbappend" class="md-nav__link">
    petalinux-image.bbappend
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="petalinux-20174-technical-note">Petalinux 2017.4 technical note</h1>
<p><em>Vu Tang - 2/2019</em></p>
<h2 id="introdutions">Introdutions</h2>
<p>Tài liệu này là tổng hợp các điểm lưu ý trong quá trình làm việc với Petalinux 2017.4. Version 2017.4 này của Xilinx là một thể hiện rõ ràng của việc ứng dụng <a href="https://www.yoctoproject.org/">YOCTO PROJECT</a> trong quá trình phát triển một hệ nhúng Linux. Để hiểu rõ hơn quá trình làm việc của petalinux 2017.4, cần tìm hiểu thêm về nguyên tắc hoạt động của Yocto. </p>
<h2 id="tips">Tips</h2>
<p><strong>Speed up sstate checking</strong></p>
<p><a href="https://forums.xilinx.com/t5/Embedded-Linux/Checking-sstate-mirror-taking-forever/td-p/775404">https://forums.xilinx.com/t5/Embedded-Linux/Checking-sstate-mirror-taking-forever/td-p/775404</a></p>
<ul>
<li>Diable sstate online in Yocto</li>
</ul>
<h2 id="worknote">Worknote</h2>
<ul>
<li>
<p>build target when use <code>petalinux build</code> is petalinux-user-image.bb. Bitbake file dir: [project dir]/project-spec/meta-plnx-generated/recipes-core/images/petalinux-user-image.bb</p>
</li>
<li>
<p>based-bitbake file be used for all project is found at: [installation dir]/components/yocto/source/</p>
</li>
<li>
<p><code>petalinux-build -x clean/distclean</code> is not affect to download dir  </p>
</li>
<li>Removing build/tmp dir need to rebuild all project (except fetching source code). This job takes a while.</li>
<li><code>petalinux-build -x distclean</code> will call <code>bitbake -c cleansstate</code> -&gt; what is cleansstate?</li>
<li>
<p><code>clean</code> -&gt; bitbake -c clean. what is defference btw <code>clean</code> &amp; <code>cleansstate</code></p>
</li>
<li>
<p>$WORKDIR: build/tmp/work/plnx_arm-xilinx-linux-gnueabi/libsample-tar/1.0-r0</p>
</li>
</ul>
<h2 id="experiences">Experiences</h2>
<h3 id="create-and-initialize-a-project">Create and initialize a project</h3>
<p>Quá trình khởi tạo project (1) và import hdf (2) tiến hành tương tự với petalinux 2015.4 (xem thêm ug1144 để biết về các cmd tương ứng cho từng quá trình). </p>
<pre><code>├── config.project
└── project-spec
    ├── attributes
    ├── configs
    │   ├── config
    │   └── rootfs_config
    ├── hw-description
    │   └── metadata
    └── meta-user
        ├── conf
        ├── COPYING.MIT
        ├── README
        ├── recipes-apps
        └── recipes-bsp
</code></pre>

<p>Kết thúc quá trình (1), project được tạo với thư mục “project-spec”. Trong đó:</p>
<ul>
<li>Thư mục con “configs” chứa các cấu hình của project (các cấu hình này được thay đổi bằng họ câu lệnh “petalinux-config”).</li>
<li>Thư mục con “hw-description” trống.</li>
<li>Thư mục con “meta-user” chứa các recipes liên quan đến user-apps và bsp. Ngoai ra thư mục này còn chứa trong ./conf các cấu hình liên quan đến Yocto cho Layer meta-user.</li>
</ul>
<p>Kết thúc quá trình (2), cấu trúc thư mục của project biến đổi như hình vẽ dưới đây.</p>
<pre><code>├── build
│   ├── cache
│   ├── conf
│   ├── config.log
│   ├── misc
│   └── tmp
├── components
│   └── plnx_workspace
├── config.project
└── project-spec
    ├── attributes
    ├── configs
    ├── hw-description
    ├── meta-plnx-generated
    ├── meta-user
    └── yocto-layer.log

</code></pre>

<p>Trong đó, xuất hiện thêm một số thư mục quan trọng sau:</p>
<ul>
<li>Thư mục “build” là thư mục được sử dụng đế tiến hành các giai đoạn trong quá trình build project. Trong đó kết quả trung gian trong các quá trình build được lưu trữ tại “tmp”. Ngoài ra, trong các quá trình tiếp theo trong “build” sẽ xuất hiện thêm thư mục “downloads” thực hiện chức năng lưu trữ các package được thực hiện trong quá trình “do_fetch”.</li>
<li>Thư mục “components” trong các phiên bản petalinux trước sẽ được sử dụng để chứa source code liên quan đến các customed-component của user. Trong phiên bản này chưa xác định được chức năng của thư mục component.</li>
<li>Xuất hiện thêm Yocto layer “meta-plnx-generated” trong thư mục “project-spec”, chứa các Yocto recipes liên quan đến kernel, core, bsp.</li>
</ul>
<p>Xem thêm Apendix A trong tài liệu ug1144 để biết thêm thông tin về Petalinux project structure.</p>
<h3 id="build-a-new-project-without-internet">Build a new project without Internet</h3>
<p>Để thực hiện build, chạy lệnh “petalinux-build”. </p>
<p><strong>Pre-build configuration</strong></p>
<ul>
<li>
<p>Bản chất của quá trình này là gọi đến target “petalinux-user-image” của Yocto project. </p>
</li>
<li>
<p>“Checking sstate mirror object availability” mất rất nhiều thời gian để thực hiện? -&gt; Tiến hành tắt bỏ chức năng check này trong petalinux-config &gt; Yocto &gt; sstate.</p>
</li>
<li>
<p>Xuất hiện lỗi liên quan đến bitbake nếu dừng quá trình build đột ngột (ví dụ dừng bằng tổ hợp phím Ctl+C). Solution here:</p>
<ul>
<li>Re-init environment:<br />
/home/user/Xilinx/Petalinux/settings.sh
/home/user/Xilinx/Petalinux/components/yocto/source/aarch64/environment-setup-aarch64-xilinx-linux</li>
<li>Remove ./build/bitbake.lock.</li>
</ul>
</li>
</ul>
<p>Các cấu hình của project được lưu trữ ở: project-spec/configs/config</p>
<p><strong>Do_fetch - What is problem?</strong></p>
<p>Trong quá trình build, petalinux sẽ thực hiện lấy các gói có sẵn trong thư mục cài đặt của petalinux, đường dẫn như sau: [Instalation Direction]/components/yocto/downloads. Ngoài ra petalinux tiến hành download từ Internet thêm các gói như:  </p>
<ul>
<li>(1) gcc-source-linaro-6.2-linaro-6.2-r2016.11  </li>
<li>(2) binutils-cross-arm-linaro-2.27-r2016.10  </li>
<li>(3) u-boot-mkimage-native-v2016.03+gitAUTOINC+df61a74e68-r0  </li>
<li>(4) binutils-native-linaro-2.27-r2016.10  </li>
<li>...  </li>
</ul>
<p>Nếu trong quá trình build không có kết nối Internet sẽ dẫn đến các thông báo build lỗi. Ví dụ như: </p>
<ul>
<li>“u-boot-mkimage-native-v2016.03+gitAUTOINC+df61a74e68-r0 do_fetch: Fetcher failure”
Như vậy, bản cài đặt mặc định của petalinux không chứa đủ các gói phần mềm sử dụng cho quá trình Yocto build (?). Cần có thêm các gói sau: </li>
<li>git2_git.linaro.org.toolchain.binutils-gdb.git tương ứng với (2) và (4)</li>
<li>git2_git.linaro.org.toolchain.gcc.git tương ứng với (1)</li>
</ul>
<p><strong>Linaro - what is this?</strong></p>
<p><strong>External kernel - How to?</strong></p>
<h3 id="boot-from-sd-card">Boot from SD card</h3>
<p>Về cơ bản, boot từ SD Card được thực hiện giống với hướng dẫn trong mục <a href="../../projects/zedboard/zedboard/#bootext4rootfs">Zedboard</a>. Tệp rootfs.cpio được chứa trong thư mục <project>/image/linux/ sẵn sàng cho quá trình đưa lên thẻ nhớ.</p>
<h3 id="mounting-sd-card-in-booting-time">Mounting SD card in booting-time</h3>
<p>Refer <a href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842475/PetaLinux+Yocto+Tips">PetaLinux Yocto Tips</a> (xilinx-wiki.atlassian.net) for step-by-step instructions.</p>
<h2 id="add-user-custom-package">Add user custom package</h2>
<p>Bản chất quản lý gói phần mềm trong petalinux là Yocto project. Mã nguồn của các gói phần mềm có thể được download từ các online repository hoặc lưu trữ trực tiếp trên máy local. Trong mục này sẽ lấy ví dụ về một gói phần mềm phổ biến, hay được sử dụng trong quá trình đánh giá chất lượng mạng: IPERF.</p>
<p>Petalinux sẽ thực hiện tải source code của iperf từ Github sau đó tiến hành cấu hình, build và tích hợp vào hệ thống.</p>
<p>Khi khởi tạo một ứng dụng (apps) mới, một package được tạo tại <code>project-spec/meta-user/recipes-apps</code>. Cấu trúc của một recipes như sau:</p>
<pre><code>vux-iperf/
├── files
│   ├── 0002-Remove-pg-from-profile_CFLAGS.patch
│   └── automake-foreign.patch
├── README
└── vux-iperf.bb
</code></pre>

<p>Trong ví dụ là cấu hình để build bản phần mềm iperf3. Bitbake file cho recipes này được tải tại <a href="https://layers.openembedded.org/layerindex/recipe/32243/">iperf3 3.6</a> (layers.openembedded.org). Nội dung file iperf3_3.6.bb như sau:</p>
<pre><code>SUMMARY = &quot;Network benchmark tool&quot;
HOMEPAGE = &quot;http://software.es.net/iperf/&quot;
SECTION = &quot;console/network&quot;
BUGTRACKER = &quot;https://github.com/esnet/iperf/issues&quot;
AUTHOR = &quot;ESNET &lt;info@es.net&gt;, Lawrence Berkeley National Laboratory &lt;websupport@lbl.gov&gt;&quot;
LICENSE = &quot;BSD&quot;
LIC_FILES_CHKSUM = &quot;file://LICENSE;md5=a9a036136b748453e839c0eb8906ef2e&quot;

DEPENDS = &quot;openssl&quot;

SRC_URI = &quot;git://github.com/esnet/iperf.git \
           file://automake-foreign.patch \
           file://0002-Remove-pg-from-profile_CFLAGS.patch \
           &quot;
SRCREV = &quot;88f3ad87f38762081a6d7127890ff5c3a052b06a&quot;

S = &quot;${WORKDIR}/git&quot;

inherit autotools

PACKAGECONFIG[lksctp] = &quot;ac_cv_header_netinet_sctp_h=yes,ac_cv_header_netinet_sctp_h=no,lksctp-tools&quot;

CFLAGS += &quot;-D_GNU_SOURCE&quot;
EXTRA_OECONF = &quot;--with-openssl=${RECIPE_SYSROOT}${prefix}&quot;
BBCLASSEXTEND = &quot;native&quot;
</code></pre>

<p><em><a href="http://cgit.openembedded.org/meta-openembedded/tree/meta-oe/recipes-benchmark/iperf3/iperf3_3.6.bb?h=master">http://cgit.openembedded.org/meta-openembedded/tree/meta-oe/recipes-benchmark/iperf3/iperf3_3.6.bb?h=master</a></em></p>
<p>Trong file vux-iperf.bb có một số khái niệm và thông tin cần lưu ý như sau.</p>
<p><strong>Đường dẫn đến source code của package</strong></p>
<p>Tham số SRC_URI chứa đường dẫn đến source code của pakcage. Thông qua thông tin chứa trong đường dẫn này, bitbake thực hiện nhiệm vụ do_fetch. </p>
<pre><code>SRC_URI = &quot;git://github.com/esnet/iperf.git \
           file://automake-foreign.patch \
</code></pre>

<p>Trong ví dụ này, SRC_URI chỉ đến một git repository của esnet. Người dùng có thể truy cập trực tiếp vào repo này để xem source code. Ngoài ra SRC_URI chỉ đến một file được lưu trữ local chứa bản patch. Bản patch này có thể được tìm thấy trên openembedded.org.</p>
<p><strong>Revision của source code</strong></p>
<p>Tham số SRCREV chỉ cho bitbake biết được revision nào của source code cần được sử dụng để build package.</p>
<p><code>SRCREV = "88d907f7fb58bfab5d086c5da60c922e1c582c92"</code></p>
<p>Ngoài ra, SRCREV còn có thể cung cấp thêm các thông tin như sau:</p>
<ul>
<li>protocol: giao thức sử dụng để fetch source code (protocol=https...)  </li>
<li>branch: branch mong muốn fetch source code (branch=master...)</li>
</ul>
<p>Tương ứng với mỗi revision chứa một file LICENSE đi kèm với MD5SUM.</p>
<p><code>LIC_FILES_CHKSUM = "file://LICENSE;md5=d098223e44bdd19585315ee75cd9d2d7"</code></p>
<p>Lưu ý rằng LIC_FILES có thể là LICENSE hoặc bất cứ tên khác. </p>
<h2 id="petalinux-imagebbappend">petalinux-image.bbappend</h2>
<p>Lưu trữ tại project-spec/meta-user/recipes-core/images/petalinux-image.bbappend chứa các package có thể được install vào hệ thống. Khi xóa các package trong file này sẽ ảnh hưởng đến petalinux-config -c rootfs.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Vu Tang.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>